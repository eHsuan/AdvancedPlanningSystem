# Advanced Planning System - 資料庫結構 (v3.1)

## 1. APS Local DB (APSLocalDB.db)
負責維護系統執行時的即時狀態與配置。

### 表：local_state_binding (卡匣綁定狀態)
| 欄位名稱 | 型別 | 說明 |
| :--- | :--- | :--- |
| carrier_id | TEXT (PK) | 卡匣 ID |
| port_id | TEXT | 目前所在 Port ID |
| lot_id | TEXT | 工單號 |
| current_step_id | TEXT | 當前站點 |
| next_step_id | TEXT | 下一站點 |
| target_eqp_id | TEXT | 目標派送機台 (或 Pass99) |
| qtime_deadline | TEXT | Q-Time 截止時間 (yyyyMMddHHmmss) |
| dispatch_score | REAL | 派貨總分 |
| score_qtime | REAL | Q-Time 分項分數 |
| score_urgent | REAL | 緊急度分項分數 |
| score_eng | REAL | 工程件分項分數 |
| score_due | REAL | 交期分項分數 |
| score_lead | REAL | 前置時間分項分數 |
| treal | REAL | 真實剩餘可用時間 (分鐘) |
| priority_type | INTEGER | 優先權 (0:一般, 1:工程, 2:急件) |
| is_hold | INTEGER | 暫停標記 (0:正常, 1:HOLD) |
| wait_reason | TEXT | 等待原因 (如: Next Step的EQ未設定) |
| bind_time | TEXT | 綁定時間 |
| dispatch_time | TEXT | 派送時間 (填入即代表已下達 OPEN) |

### 表：local_state_transit (運輸中狀態)
| 欄位名稱 | 型別 | 說明 |
| :--- | :--- | :--- |
| carrier_id | TEXT (PK) | 卡匣 ID |
| target_eqp_id | TEXT | 目標機台 |
| pickup_time | TEXT | 人員取走時間 |
| expected_arrival_time | TEXT | 預計抵達時間 (含 Buffer) |

---

## 2. Mock MES DB (APSSimulatorDB.db)
模擬器使用的資料庫，模擬工廠上層系統。

### 表：mock_mes_orders (生產工單)
| 欄位名稱 | 型別 | 說明 |
| :--- | :--- | :--- |
| work_no | TEXT (PK) | 工單號 |
| carrier_id | TEXT | 卡匣 ID |
| step_id | TEXT | 當前站點 |
| next_step_id | TEXT | 下一站點 (由模擬器自動計算跳轉) |
| current_seq_no | INTEGER | 目前站點在 Route 中的順序 |
| priority_type | INTEGER | 優先級 (0: 一般, 1: 工程, 2: 急件) |
| prev_out_time | TEXT | 前一站出站時間 (用於計算 Q-Time) |
| due_date | TEXT | 交期 |
| route_id | TEXT | 流程代碼 |
